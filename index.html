<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Management Toolkit - Rice Vendor</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #f5f1e8 0%, #e8e0d5 100%);
            min-height: 100vh;
            padding: 20px;
            color: #2d3436;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #3d5a2c 0%, #5a7c3e 100%);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-icon {
            font-size: 56px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .header h1 {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .header p {
            font-size: 16px;
            opacity: 0.95;
            margin-top: 5px;
        }

        .nav-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .tab-btn {
            padding: 14px 28px;
            background: #f8f9fa;
            color: #2d3436;
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .tab-btn:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #3d5a2c 0%, #5a7c3e 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(61, 90, 44, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.4s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }

        .stat-card {
            padding: 28px;
            border-radius: 16px;
            color: white;
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            transform: translate(30%, -30%);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.2);
        }

        .stat-card h3 {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 12px;
            opacity: 0.95;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-card .amount {
            font-size: 40px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            position: relative;
            z-index: 1;
        }

        .green-card { background: linear-gradient(135deg, #4a7c3e 0%, #5a8c4e 100%); }
        .beige-card { background: linear-gradient(135deg, #c9a961 0%, #d4b76e 100%); }
        .orange-card { background: linear-gradient(135deg, #c67d3e 0%, #d68c4a 100%); }
        .red-card { background: linear-gradient(135deg, #a84c3e 0%, #b85d4f 100%); }

        .chart-container {
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .chart-container h3 {
            margin-bottom: 24px;
            color: #2d3436;
            font-size: 24px;
            font-weight: 700;
        }

        .form-section {
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #2d3436;
            margin-bottom: 24px;
            font-size: 24px;
            font-weight: 700;
            border-bottom: 3px solid #5a7c3e;
            padding-bottom: 12px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 10px;
            color: #2d3436;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group input,
        .form-group select {
            padding: 14px 16px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            background: #f8f9fa;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #5a7c3e;
            background: white;
            box-shadow: 0 0 0 3px rgba(90, 124, 62, 0.1);
        }

        .form-group input.invalid,
        .form-group select.invalid {
            border-color: #dc3545;
            background: #fff5f5;
        }

        .form-group input.invalid:focus,
        .form-group select.invalid:focus {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.15);
        }

        .btn {
            padding: 14px 32px;
            border: none;
            border-radius: 10px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3d5a2c 0%, #5a7c3e 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(61, 90, 44, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(61, 90, 44, 0.4);
        }

        .btn-primary:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(61, 90, 44, 0.3);
        }

        .btn-danger {
            background: linear-gradient(135deg, #a84c3e 0%, #b85d4f 100%);
            color: white;
            padding: 10px 20px;
            font-size: 13px;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(168, 76, 62, 0.3);
        }

        .btn-danger:active {
            transform: translateY(0);
            box-shadow: 0 2px 6px rgba(168, 76, 62, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #4a7c3e 0%, #5a8c4e 100%);
            color: white;
        }

        .table-container {
            overflow-x: auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        .table-container h3 {
            padding: 24px 24px 0 24px;
            color: #2d3436;
            font-size: 22px;
            font-weight: 700;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, #3d5a2c 0%, #5a7c3e 100%);
            color: white;
        }

        th {
            padding: 18px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            padding: 18px;
            border-bottom: 1px solid #e1e8ed;
            color: #2d3436;
            font-size: 15px;
        }

        tbody tr:hover {
            background: #f8f9fa;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        .status-badge {
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            display: inline-block;
        }

        .status-paid { background: #d4edda; color: #155724; }
        .status-unpaid { background: #f8d7da; color: #721c24; }
        .status-partial { background: #fff3cd; color: #856404; }

        /* ===================== FIXED CHART STYLES ===================== */
        .chart-wrapper {
            background: #f5ede1;
            padding: 20px 24px 20px 24px;
            border-radius: 12px;
            border: 2px solid #d4c4a8;
            overflow: hidden; /* FIX: prevent bars from going outside */
            position: relative;
        }

        /* Y-axis grid lines for visual reference */
        .chart-grid {
            position: relative;
            height: 240px; /* Fixed, controlled height */
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            gap: 12px;
            padding-bottom: 0;
        }

        /* Subtle horizontal grid lines */
        .chart-grid::before,
        .chart-grid::after {
            content: '';
            position: absolute;
            left: 0; right: 0;
            border-top: 1px dashed rgba(0,0,0,0.1);
        }
        .chart-grid::before { top: 0; }
        .chart-grid::after { top: 50%; }

        .bar-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            flex: 1;
            height: 100%;
            justify-content: flex-end;
        }

        .bars {
            display: flex;
            gap: 6px;
            align-items: flex-end;
            width: 100%;
            justify-content: center;
        }

        .bar {
            width: 38px;
            border-radius: 6px 6px 0 0;
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            cursor: pointer;
            min-height: 3px; /* Always show a tiny sliver even for 0 */
        }

        .bar:hover {
            opacity: 0.8;
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        /* Tooltip on hover */
        .bar[title]:hover::after {
            content: attr(title);
            position: absolute;
            bottom: calc(100% + 6px);
            left: 50%;
            transform: translateX(-50%);
            background: #2d3436;
            color: white;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
            z-index: 10;
            font-family: 'Inter', sans-serif;
        }

        .income-bar { background: linear-gradient(to top, #3d5a2c, #5a8c4e); }
        .expense-bar { background: linear-gradient(to top, #c67d3e, #d68c4a); }

        .day-label {
            font-weight: 600;
            color: #2d3436;
            font-size: 13px;
            text-align: center;
            flex-shrink: 0;
        }

        .chart-legend {
            display: flex;
            gap: 24px;
            justify-content: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 2px solid #d4c4a8;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #2d3436;
            font-size: 14px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }
        /* ===================== END CHART FIX ===================== */

        .net-profit {
            text-align: center;
            margin-top: 24px;
            padding: 20px;
            background: linear-gradient(135deg, #4a7c3e 0%, #5a8c4e 100%);
            border-radius: 12px;
            font-size: 28px;
            font-weight: 700;
            color: white;
            box-shadow: 0 4px 12px rgba(74, 124, 62, 0.3);
        }

        .budget-summary {
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        .budget-summary h3 {
            color: #2d3436;
            margin-bottom: 24px;
            font-size: 24px;
            font-weight: 700;
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            padding: 18px 20px;
            margin: 12px 0;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 600;
            align-items: center;
        }

        .budget-expected { background: #c9ddc4; color: #2d4a26; border: 2px solid #b0cca8; }
        .budget-planned { background: #f5e9c8; color: #6b5a2e; border: 2px solid #e8d7a8; }
        .budget-actual { background: #f5dcc8; color: #6b4a2e; border: 2px solid #e8c4a8; }
        .budget-balance { background: linear-gradient(135deg, #3d5a2c 0%, #5a7c3e 100%); color: white; font-size: 22px; box-shadow: 0 4px 12px rgba(61, 90, 44, 0.3); }
        .budget-partial { background: #f5e9c8; color: #6b5a2e; border: 2px solid #e8d7a8; }

        .alert {
            padding: 18px 20px;
            border-radius: 10px;
            margin: 12px 0;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-success { background: #c9ddc4; color: #2d4a26; border: 2px solid #b0cca8; }
        .alert-warning { background: #f5e9c8; color: #6b5a2e; border: 2px solid #e8d7a8; }
        .alert-danger { background: #f5ccc8; color: #6b2e2e; border: 2px solid #e8a8a8; }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }

        .empty-state-icon { font-size: 64px; margin-bottom: 16px; opacity: 0.5; }
        .empty-state h4 { font-size: 20px; margin-bottom: 8px; color: #495057; }
        .empty-state p { font-size: 15px; }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 0; }
            .header { padding: 20px 15px; flex-direction: column; text-align: center; gap: 10px; }
            .header h1 { font-size: 22px; line-height: 1.3; }
            .header p { font-size: 13px; }
            .header-icon { font-size: 36px; }
            .dashboard-grid { grid-template-columns: 1fr; gap: 15px; }
            .stat-card { padding: 20px 15px; }
            .stat-card h3 { font-size: 12px; }
            .stat-card .amount { font-size: 28px; }
            .form-grid { grid-template-columns: 1fr; gap: 15px; }
            .form-section, .chart-container, .budget-summary, .table-container { padding: 20px 15px; margin-bottom: 15px; }
            .form-section h3, .chart-container h3, .budget-summary h3, .table-container h3 { font-size: 18px; margin-bottom: 15px; }
            .nav-tabs { padding: 8px; gap: 6px; margin-bottom: 15px; }
            .tab-btn { padding: 10px 12px; font-size: 12px; flex: 1 1 calc(50% - 3px); text-align: center; min-width: 0; }
            .form-group input, .form-group select { padding: 12px 14px; font-size: 14px; }
            .btn { padding: 12px 24px; font-size: 14px; width: 100%; }
            .btn-danger { padding: 8px 12px; font-size: 11px; width: auto; }
            .chart-grid { height: 160px; gap: 6px; }
            .bar { width: 22px; }
            .bars { gap: 4px; }
            .day-label { font-size: 11px; }
            .chart-legend { flex-direction: row; gap: 15px; font-size: 12px; }
            .legend-color { width: 16px; height: 16px; }
            .net-profit { font-size: 20px; padding: 15px; }
            .table-container { border-radius: 12px; }
            .table-container h3 { padding: 15px; }
            table { font-size: 12px; }
            th { padding: 10px 8px; font-size: 11px; }
            td { padding: 10px 8px; font-size: 12px; }
            .budget-item { padding: 12px 15px; font-size: 14px; flex-direction: column; align-items: flex-start; gap: 5px; }
            .budget-item span { font-size: 16px; }
            .budget-balance { font-size: 16px; }
            .budget-balance span { font-size: 20px; }
            .alert { padding: 12px 15px; font-size: 13px; }
            .empty-state { padding: 40px 15px; }
            .empty-state-icon { font-size: 48px; }
            .empty-state h4 { font-size: 16px; }
            .empty-state p { font-size: 13px; }
            .status-badge { font-size: 11px; padding: 4px 10px; }
        }

        @media (max-width: 480px) {
            body { padding: 5px; }
            .header { padding: 15px 10px; }
            .header h1 { font-size: 18px; }
            .header p { font-size: 12px; }
            .stat-card .amount { font-size: 24px; }
            .tab-btn { font-size: 11px; padding: 8px 10px; }
            .form-section, .chart-container, .budget-summary, .table-container { padding: 15px 10px; }
            .chart-grid { height: 130px; }
            .bar { width: 18px; }
            th, td { padding: 8px 5px; font-size: 11px; }
            .btn-danger { font-size: 10px; padding: 6px 10px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-icon">üåæ</div>
            <div>
                <h1>Financial Management Toolkit</h1>
                <p>Rice Vendor Dashboard System</p>
            </div>
        </div>

        <div class="nav-tabs" id="navTabs">
            <button class="tab-btn active" data-tab="dashboard">üìä Dashboard</button>
            <button class="tab-btn" data-tab="sales">üí∞ Sales Recording</button>
            <button class="tab-btn" data-tab="credit">üìù Credit Management</button>
            <button class="tab-btn" data-tab="expenses">üí≥ Expense Tracker</button>
            <button class="tab-btn" data-tab="budget">üìà Budget Planner</button>
            <button class="tab-btn" data-tab="summary">üìë Summary</button>
        </div>

        <!-- DASHBOARD TAB -->
        <div id="dashboard" class="tab-content active">
            <div class="dashboard-grid">
                <div class="stat-card green-card">
                    <h3>Today's Sales</h3>
                    <div class="amount" id="todaySales">‚Ç±0.00</div>
                </div>
                <div class="stat-card beige-card">
                    <h3>Weekly Income</h3>
                    <div class="amount" id="weeklyIncome">‚Ç±0.00</div>
                </div>
                <div class="stat-card orange-card">
                    <h3>Total Expenses</h3>
                    <div class="amount" id="totalExpenses">‚Ç±0.00</div>
                </div>
                <div class="stat-card red-card">
                    <h3>Customer Debts</h3>
                    <div class="amount" id="customerDebts">‚Ç±0.00</div>
                </div>
            </div>

            <div class="chart-container">
                <h3>Income & Expenses This Week</h3>
                <div class="chart-wrapper">
                    <div class="chart-grid" id="weeklyChart"></div>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(to top, #3d5a2c, #5a8c4e);"></div>
                            <span>Income</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: linear-gradient(to top, #c67d3e, #d68c4a);"></div>
                            <span>Expenses</span>
                        </div>
                    </div>
                </div>
                <div class="net-profit">
                    Net Profit: <span id="netProfit">‚Ç±0.00</span>
                </div>
            </div>
        </div>

        <!-- SALES RECORDING TAB -->
        <div id="sales" class="tab-content">
            <div class="form-section">
                <h3>Record New Sale</h3>
                <form id="salesForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="saleDate" required>
                        </div>
                        <div class="form-group">
                            <label>Kilos Sold</label>
                            <input type="number" id="saleKilos" step="0.01" min="0.01" placeholder="25" required>
                        </div>
                        <div class="form-group">
                            <label>Price per Kilo (‚Ç±)</label>
                            <input type="number" id="salePrice" step="0.01" min="0.01" placeholder="75.00" required>
                        </div>
                        <div class="form-group">
                            <label>Transaction Type</label>
                            <select id="saleType" required>
                                <option value="Cash">Cash</option>
                                <option value="Credit">Credit</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group" style="margin-bottom: 20px;">
                        <label>Customer Name (for Credit transactions)</label>
                        <input type="text" id="saleCustomer" placeholder="Leave blank for cash sales">
                    </div>
                    <button type="submit" class="btn btn-primary">‚ûï Add Sale</button>
                </form>
            </div>

            <div class="table-container">
                <h3>Sales Record</h3>
                <table id="salesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Kilos Sold</th>
                            <th>Price/kg</th>
                            <th>Type</th>
                            <th>Customer</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="salesTableBody">
                        <tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">üìä</div><h4>No sales recorded yet</h4><p>Start by adding your first sale above</p></div></td></tr>
                    </tbody>
                </table>
            </div>

            <div class="form-section">
                <h3>Sales Summary</h3>
                <div class="budget-item budget-expected">Daily Total: <span id="dailySalesTotal">‚Ç±0.00</span></div>
                <div class="budget-item budget-balance">Weekly Total: <span id="weeklySalesTotal">‚Ç±0.00</span></div>
            </div>
        </div>

        <!-- CREDIT MANAGEMENT TAB -->
        <div id="credit" class="tab-content">
            <div class="form-section">
                <h3>Customer Credit Overview</h3>
                <div class="alert alert-warning">
                    üí∞ Total Outstanding Debts: <span id="totalOutstanding">‚Ç±0.00</span>
                </div>
            </div>

            <div class="table-container">
                <h3>Credit Accounts</h3>
                <table id="creditTable">
                    <thead>
                        <tr>
                            <th>Customer Name</th>
                            <th>Amount Owed</th>
                            <th>Date</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="creditTableBody">
                        <tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üí≥</div><h4>No credit transactions yet</h4><p>Credit sales will appear here</p></div></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- EXPENSE TRACKER TAB -->
        <div id="expenses" class="tab-content">
            <div class="form-section">
                <h3>Record New Expense</h3>
                <form id="expenseForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                        <div class="form-group">
                            <label>Type of Expense</label>
                            <select id="expenseType" required>
                                <option value="Rice Supply">Rice Supply</option>
                                <option value="Utilities">Utilities</option>
                                <option value="Transportation">Transportation</option>
                                <option value="Others">Others</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Amount (‚Ç±)</label>
                            <input type="number" id="expenseAmount" step="0.01" min="0.01" placeholder="1000.00" required>
                        </div>
                        <div class="form-group">
                            <label>Description</label>
                            <input type="text" id="expenseDesc" placeholder="Optional details">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">‚ûï Add Expense</button>
                </form>
            </div>

            <div class="table-container">
                <h3>Expense Record</h3>
                <table id="expenseTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Description</th>
                            <th>Amount</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="expenseTableBody">
                        <tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üí∏</div><h4>No expenses recorded yet</h4><p>Start tracking your expenses above</p></div></td></tr>
                    </tbody>
                </table>
            </div>

            <div class="form-section">
                <h3>Expense Summary</h3>
                <div class="budget-item budget-actual">Daily Total: <span id="dailyExpenseTotal">‚Ç±0.00</span></div>
                <div class="budget-item budget-balance">Weekly Total: <span id="weeklyExpenseTotal">‚Ç±0.00</span></div>
            </div>
        </div>

        <!-- BUDGET PLANNER TAB -->
        <div id="budget" class="tab-content">
            <div class="form-section">
                <h3>Set Weekly Budget</h3>
                <form id="budgetForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Expected Income (‚Ç±)</label>
                            <input type="number" id="expectedIncome" step="0.01" min="0" placeholder="13000.00">
                        </div>
                        <div class="form-group">
                            <label>Planned Expenses (‚Ç±)</label>
                            <input type="number" id="plannedExpenses" step="0.01" min="0" placeholder="8000.00">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Update Budget</button>
                </form>
            </div>

            <div class="budget-summary">
                <h3>Budget Overview</h3>
                <div class="budget-item budget-expected">Expected Income: <span id="budgetExpectedIncome">‚Ç±0.00</span></div>
                <div class="budget-item budget-planned">Planned Expenses: <span id="budgetPlannedExpenses">‚Ç±0.00</span></div>
                <div class="budget-item budget-actual">Actual Expenses: <span id="budgetActualExpenses">‚Ç±0.00</span></div>
                <div class="budget-item budget-balance">Remaining Balance: <span id="budgetBalance">‚Ç±0.00</span></div>
                <div id="budgetAlert"></div>
            </div>
        </div>

        <!-- SUMMARY TAB -->
        <div id="summary" class="tab-content">
            <div class="form-section">
                <h3>Financial Summary Report</h3>
                
                <div class="dashboard-grid" style="margin-top: 24px;">
                    <div class="stat-card green-card">
                        <h3>Total Sales</h3>
                        <div class="amount" id="summaryTotalSales">‚Ç±0.00</div>
                    </div>
                    <div class="stat-card orange-card">
                        <h3>Total Expenses</h3>
                        <div class="amount" id="summaryTotalExpenses">‚Ç±0.00</div>
                    </div>
                    <div class="stat-card beige-card">
                        <h3>Net Income</h3>
                        <div class="amount" id="summaryNetIncome">‚Ç±0.00</div>
                    </div>
                    <div class="stat-card red-card">
                        <h3>Total Customer Debts</h3>
                        <div class="amount" id="summaryTotalDebts">‚Ç±0.00</div>
                    </div>
                </div>

                <div class="budget-summary" style="margin-top: 30px;">
                    <h3>Cash Flow Analysis</h3>
                    <div class="budget-item budget-expected">Cash Sales: <span id="summaryCashSales">‚Ç±0.00</span></div>
                    <div class="budget-item budget-partial">Credit Sales: <span id="summaryCreditSales">‚Ç±0.00</span></div>
                    <div class="budget-item budget-balance">Profitability Margin: <span id="summaryProfitability">0%</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const STORAGE_KEYS = {
            SALES: 'riceVendor_sales',
            EXPENSES: 'riceVendor_expenses',
            BUDGET: 'riceVendor_budget'
        };

        function saveToStorage(key, data) { localStorage.setItem(key, JSON.stringify(data)); }
        function loadFromStorage(key) { const d = localStorage.getItem(key); return d ? JSON.parse(d) : null; }

        let sales = loadFromStorage(STORAGE_KEYS.SALES) || [];
        let expenses = loadFromStorage(STORAGE_KEYS.EXPENSES) || [];
        let budget = loadFromStorage(STORAGE_KEYS.BUDGET) || { expectedIncome: 0, plannedExpenses: 0 };

        document.getElementById('saleDate').valueAsDate = new Date();
        document.getElementById('expenseDate').valueAsDate = new Date();

        document.querySelectorAll('.tab-btn').forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');
                document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(tabName).classList.add('active');
                this.classList.add('active');
                updateAllData();
            });
        });

        function validateInput(input) {
            if (input.hasAttribute('required') && !input.value.trim()) {
                input.classList.add('invalid'); return false;
            } else { input.classList.remove('invalid'); return true; }
        }

        document.querySelectorAll('input[required], select[required]').forEach(input => {
            input.addEventListener('blur', function() { validateInput(this); });
            input.addEventListener('input', function() { if (this.value.trim()) this.classList.remove('invalid'); });
        });

        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('keypress', function(e) {
                const char = String.fromCharCode(e.which);
                if (!/[\d.]/.test(char)) e.preventDefault();
                if (char === '.' && this.value.includes('.')) e.preventDefault();
            });
            input.addEventListener('input', function() { if (this.value < 0) this.value = Math.abs(this.value); });
        });

        document.getElementById('salesForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const requiredFields = this.querySelectorAll('[required]');
            let isValid = true;
            requiredFields.forEach(field => { if (!validateInput(field)) isValid = false; });
            if (!isValid) { alert('Please fill in all required fields.'); return; }

            const sale = {
                id: Date.now(),
                date: document.getElementById('saleDate').value,
                kilos: parseFloat(document.getElementById('saleKilos').value),
                price: parseFloat(document.getElementById('salePrice').value),
                type: document.getElementById('saleType').value,
                customer: document.getElementById('saleCustomer').value || 'N/A',
                total: parseFloat(document.getElementById('saleKilos').value) * parseFloat(document.getElementById('salePrice').value),
                paymentStatus: document.getElementById('saleType').value === 'Cash' ? 'Paid' : 'Unpaid'
            };

            sales.push(sale);
            saveToStorage(STORAGE_KEYS.SALES, sales);
            this.reset();
            document.getElementById('saleDate').valueAsDate = new Date();
            updateAllData();
        });

        document.getElementById('expenseForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const requiredFields = this.querySelectorAll('[required]');
            let isValid = true;
            requiredFields.forEach(field => { if (!validateInput(field)) isValid = false; });
            if (!isValid) { alert('Please fill in all required fields.'); return; }

            const expense = {
                id: Date.now(),
                date: document.getElementById('expenseDate').value,
                type: document.getElementById('expenseType').value,
                amount: parseFloat(document.getElementById('expenseAmount').value),
                description: document.getElementById('expenseDesc').value || 'N/A'
            };

            expenses.push(expense);
            saveToStorage(STORAGE_KEYS.EXPENSES, expenses);
            this.reset();
            document.getElementById('expenseDate').valueAsDate = new Date();
            updateAllData();
        });

        document.getElementById('budgetForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const expectedIncome = parseFloat(document.getElementById('expectedIncome').value) || 0;
            const plannedExpenses = parseFloat(document.getElementById('plannedExpenses').value) || 0;
            if (expectedIncome === 0 && plannedExpenses === 0) { alert('Please enter at least one budget value.'); return; }
            budget.expectedIncome = expectedIncome;
            budget.plannedExpenses = plannedExpenses;
            saveToStorage(STORAGE_KEYS.BUDGET, budget);
            updateAllData();
            alert('Budget updated successfully!');
        });

        function deleteSale(id) {
            if (confirm('Are you sure you want to delete this sale record?')) {
                sales = sales.filter(s => s.id !== id);
                saveToStorage(STORAGE_KEYS.SALES, sales);
                updateAllData();
            }
        }

        function deleteExpense(id) {
            if (confirm('Are you sure you want to delete this expense record?')) {
                expenses = expenses.filter(e => e.id !== id);
                saveToStorage(STORAGE_KEYS.EXPENSES, expenses);
                updateAllData();
            }
        }

        function updatePaymentStatus(id, status) {
            const sale = sales.find(s => s.id === id);
            if (sale) { sale.paymentStatus = status; saveToStorage(STORAGE_KEYS.SALES, sales); updateAllData(); }
        }

        function formatCurrency(amount) {
            return `‚Ç±${amount.toLocaleString('en-PH', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        function calculateTotals() {
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            return {
                todaySales: sales.filter(s => s.date === today).reduce((sum, s) => sum + s.total, 0),
                weeklyIncome: sales.filter(s => s.date >= weekAgo).reduce((sum, s) => sum + s.total, 0),
                totalExpenses: expenses.filter(e => e.date >= weekAgo).reduce((sum, e) => sum + e.amount, 0),
                customerDebts: sales.filter(s => s.type === 'Credit' && s.paymentStatus !== 'Paid').reduce((sum, s) => sum + s.total, 0)
            };
        }

        function updateAllData() {
            const totals = calculateTotals();
            document.getElementById('todaySales').textContent = formatCurrency(totals.todaySales);
            document.getElementById('weeklyIncome').textContent = formatCurrency(totals.weeklyIncome);
            document.getElementById('totalExpenses').textContent = formatCurrency(totals.totalExpenses);
            document.getElementById('customerDebts').textContent = formatCurrency(totals.customerDebts);
            document.getElementById('netProfit').textContent = formatCurrency(totals.weeklyIncome - totals.totalExpenses);
            updateSalesTable();
            updateCreditTable();
            updateExpenseTable();
            updateWeeklyChart();
            updateBudgetDisplay();
            updateSummaryTab();
        }

        function updateSalesTable() {
            const tbody = document.getElementById('salesTableBody');
            tbody.innerHTML = '';
            if (sales.length === 0) {
                tbody.innerHTML = `<tr><td colspan="7"><div class="empty-state"><div class="empty-state-icon">üìä</div><h4>No sales recorded yet</h4><p>Start by adding your first sale above</p></div></td></tr>`;
                document.getElementById('dailySalesTotal').textContent = formatCurrency(0);
                document.getElementById('weeklySalesTotal').textContent = formatCurrency(0);
                return;
            }
            sales.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(sale => {
                const row = tbody.insertRow();
                row.innerHTML = `<td>${sale.date}</td><td>${sale.kilos} kg</td><td>${formatCurrency(sale.price)}</td><td>${sale.type}</td><td>${sale.customer}</td><td><strong>${formatCurrency(sale.total)}</strong></td><td><button class="btn btn-danger" onclick="deleteSale(${sale.id})">üóëÔ∏è Delete</button></td>`;
            });
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            document.getElementById('dailySalesTotal').textContent = formatCurrency(sales.filter(s => s.date === today).reduce((sum, s) => sum + s.total, 0));
            document.getElementById('weeklySalesTotal').textContent = formatCurrency(sales.filter(s => s.date >= weekAgo).reduce((sum, s) => sum + s.total, 0));
        }

        function updateCreditTable() {
            const tbody = document.getElementById('creditTableBody');
            tbody.innerHTML = '';
            const creditSales = sales.filter(s => s.type === 'Credit');
            if (creditSales.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üí≥</div><h4>No credit transactions yet</h4><p>Credit sales will appear here</p></div></td></tr>`;
                document.getElementById('totalOutstanding').textContent = formatCurrency(0);
                return;
            }
            let totalOutstanding = 0;
            creditSales.forEach(sale => {
                const status = sale.paymentStatus || 'Unpaid';
                if (status !== 'Paid') totalOutstanding += sale.total;
                const row = tbody.insertRow();
                row.innerHTML = `<td><strong>${sale.customer}</strong></td><td>${formatCurrency(sale.total)}</td><td>${sale.date}</td><td><span class="status-badge status-${status.toLowerCase()}">${status}</span></td><td><select onchange="updatePaymentStatus(${sale.id}, this.value)" style="padding: 8px 12px; border-radius: 8px; border: 2px solid #e1e8ed; font-family: 'Inter', sans-serif; font-weight: 600;"><option value="Unpaid" ${status === 'Unpaid' ? 'selected' : ''}>Unpaid</option><option value="Partial" ${status === 'Partial' ? 'selected' : ''}>Partial</option><option value="Paid" ${status === 'Paid' ? 'selected' : ''}>Paid</option></select></td>`;
            });
            document.getElementById('totalOutstanding').textContent = formatCurrency(totalOutstanding);
        }

        function updateExpenseTable() {
            const tbody = document.getElementById('expenseTableBody');
            tbody.innerHTML = '';
            if (expenses.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5"><div class="empty-state"><div class="empty-state-icon">üí∏</div><h4>No expenses recorded yet</h4><p>Start tracking your expenses above</p></div></td></tr>`;
                document.getElementById('dailyExpenseTotal').textContent = formatCurrency(0);
                document.getElementById('weeklyExpenseTotal').textContent = formatCurrency(0);
                return;
            }
            expenses.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(expense => {
                const row = tbody.insertRow();
                row.innerHTML = `<td>${expense.date}</td><td><strong>${expense.type}</strong></td><td>${expense.description}</td><td><strong>${formatCurrency(expense.amount)}</strong></td><td><button class="btn btn-danger" onclick="deleteExpense(${expense.id})">üóëÔ∏è Delete</button></td>`;
            });
            const today = new Date().toISOString().split('T')[0];
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            document.getElementById('dailyExpenseTotal').textContent = formatCurrency(expenses.filter(e => e.date === today).reduce((sum, e) => sum + e.amount, 0));
            document.getElementById('weeklyExpenseTotal').textContent = formatCurrency(expenses.filter(e => e.date >= weekAgo).reduce((sum, e) => sum + e.amount, 0));
        }

        function updateWeeklyChart() {
            const chart = document.getElementById('weeklyChart');
            chart.innerHTML = '';

            // Get the actual rendered height of the chart container
            const containerHeight = chart.clientHeight || 240;
            // Max bar height = container height minus a small top buffer
            const MAX_BAR_HEIGHT = containerHeight - 10;

            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

            const dailyData = days.map((day, index) => {
                const date = new Date(weekAgo);
                date.setDate(date.getDate() + index);
                const dateStr = date.toISOString().split('T')[0];
                return {
                    day,
                    income: sales.filter(s => s.date === dateStr).reduce((sum, s) => sum + s.total, 0),
                    expense: expenses.filter(e => e.date === dateStr).reduce((sum, e) => sum + e.amount, 0)
                };
            });

            // Find the max value across all days (with a minimum so empty chart still renders nicely)
            const maxValue = Math.max(...dailyData.map(d => Math.max(d.income, d.expense)), 1);

            dailyData.forEach(({ day, income, expense }) => {
                // Scale height to fit perfectly within container ‚Äî cap at MAX_BAR_HEIGHT
                const incomeH = Math.min(Math.round((income / maxValue) * MAX_BAR_HEIGHT), MAX_BAR_HEIGHT);
                const expenseH = Math.min(Math.round((expense / maxValue) * MAX_BAR_HEIGHT), MAX_BAR_HEIGHT);

                const barGroup = document.createElement('div');
                barGroup.className = 'bar-group';
                barGroup.innerHTML = `
                    <div class="bars">
                        <div class="bar income-bar" style="height:${incomeH}px;" title="Income: ${formatCurrency(income)}"></div>
                        <div class="bar expense-bar" style="height:${expenseH}px;" title="Expense: ${formatCurrency(expense)}"></div>
                    </div>
                    <div class="day-label">${day}</div>
                `;
                chart.appendChild(barGroup);
            });
        }

        function updateBudgetDisplay() {
            const weekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0];
            const actualExpenses = expenses.filter(e => e.date >= weekAgo).reduce((sum, e) => sum + e.amount, 0);
            const balance = budget.expectedIncome - actualExpenses;
            document.getElementById('budgetExpectedIncome').textContent = formatCurrency(budget.expectedIncome);
            document.getElementById('budgetPlannedExpenses').textContent = formatCurrency(budget.plannedExpenses);
            document.getElementById('budgetActualExpenses').textContent = formatCurrency(actualExpenses);
            document.getElementById('budgetBalance').textContent = formatCurrency(balance);
            const alertDiv = document.getElementById('budgetAlert');
            if (actualExpenses > budget.plannedExpenses && budget.plannedExpenses > 0) {
                alertDiv.innerHTML = '<div class="alert alert-danger">‚ö†Ô∏è Warning: You have exceeded your planned budget!</div>';
            } else if (actualExpenses > budget.plannedExpenses * 0.9 && budget.plannedExpenses > 0) {
                alertDiv.innerHTML = '<div class="alert alert-warning">‚ö†Ô∏è Caution: You are approaching your budget limit (90%)</div>';
            } else if (budget.plannedExpenses > 0) {
                alertDiv.innerHTML = '<div class="alert alert-success">‚úì Good job! You are staying within your budget</div>';
            } else {
                alertDiv.innerHTML = '';
            }
        }

        function updateSummaryTab() {
            const totalSales = sales.reduce((sum, s) => sum + s.total, 0);
            const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
            const netIncome = totalSales - totalExpenses;
            const totalDebts = sales.filter(s => s.type === 'Credit' && s.paymentStatus !== 'Paid').reduce((sum, s) => sum + s.total, 0);
            const cashSales = sales.filter(s => s.type === 'Cash').reduce((sum, s) => sum + s.total, 0);
            const creditSales = sales.filter(s => s.type === 'Credit').reduce((sum, s) => sum + s.total, 0);
            const profitability = totalSales > 0 ? ((netIncome / totalSales) * 100).toFixed(2) : 0;
            document.getElementById('summaryTotalSales').textContent = formatCurrency(totalSales);
            document.getElementById('summaryTotalExpenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('summaryNetIncome').textContent = formatCurrency(netIncome);
            document.getElementById('summaryTotalDebts').textContent = formatCurrency(totalDebts);
            document.getElementById('summaryCashSales').textContent = formatCurrency(cashSales);
            document.getElementById('summaryCreditSales').textContent = formatCurrency(creditSales);
            document.getElementById('summaryProfitability').textContent = `${profitability}%`;
        }

        updateAllData();
    </script>
</body>
</html>